import win32com.client as win32

# CONFIG
TARGET_FOLDER_NAME = "Python Drafts"  # Must already exist in your Outlook

try:
    outlook = win32.Dispatch("Outlook.Application")
    namespace = outlook.GetNamespace("MAPI")

    # Get the default mailbox
    inbox = namespace.GetDefaultFolder(6)  # 6 = Inbox
    parent_folder = inbox.Parent

    # Search for the target folder under the root
    target_folder = None
    for folder in parent_folder.Folders:
        if folder.Name == TARGET_FOLDER_NAME:
            target_folder = folder
            break

    if not target_folder:
        raise Exception(f"Folder '{TARGET_FOLDER_NAME}' not found in your mailbox.")

    # Create the email
    mail = outlook.CreateItem(0)
    mail.To = "your.email@yourdomain.com"
    mail.Subject = "Draft in Custom Folder"
    mail.Body = "This draft was saved to a specific folder via Python."

    # Save to Drafts first
    mail.Save()

    # Move the draft to the specific folder
    mail.Move(target_folder)
    print(f"Email saved to folder: {TARGET_FOLDER_NAME}")

except Exception as e:
    print(f"[ERROR] {e}")
