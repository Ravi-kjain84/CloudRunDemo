import csv
import pandas as pd
import GetJiras
from jira_details import header
from datetime import datetime

# Step 1: Fetch data
jira_logger = GetJiras.jira_history_logger()

# Step 2: Combine header and data into a DataFrame
df = pd.DataFrame(jira_logger, columns=header)

# Step 3: Define a parser function
def clean_timestamp(val):
    try:
        val = str(val).replace('T', ' ')
        return pd.to_datetime(val, utc=True).strftime('%Y-%m-%d %H:%M:%S')
    except:
        return ''

# Step 4: Clean 'created' and 'Timestamp' columns
for col in ['created', 'Timestamp']:
    if col in df.columns:
        df[col] = df[col].apply(clean_timestamp)

# Step 5: Write to CSV
df.to_csv("jira_logs.csv", index=False, sep=",")