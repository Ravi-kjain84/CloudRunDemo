import csv
import pandas as pd
import GetJiras
from jira_details import header
from datetime import datetime

# Step 1: Fetch data
jira_logger = GetJiras.jira_history_logger()

# Step 2: Combine header and data into a DataFrame
df = pd.DataFrame(jira_logger, columns=header)

# Step 3: Clean up 'created' column
if 'created' in df.columns:
    df['created'] = df['created'].astype(str).str.replace('T', ' ', regex=False)

    def parse_created(val):
        try:
            return pd.to_datetime(val, utc=True).strftime('%Y-%m-%d %H:%M:%S')
        except:
            return ''
    
    df['created'] = df['created'].apply(parse_created)

# Step 4: Write to CSV
df.to_csv("jira_logs.csv", index=False, sep=",")