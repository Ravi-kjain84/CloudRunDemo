import win32com.client as win32

# CONFIGURATION
SHARED_MAILBOX_NAME = "testing.coe@noexternalmail.hsbc.com"
TARGET_FOLDER_NAME = "Python draft shared test test test"

try:
    outlook = win32.Dispatch("Outlook.Application")
    namespace = outlook.GetNamespace("MAPI")

    # STEP 1: Access the shared mailbox
    recipient = namespace.CreateRecipient(SHARED_MAILBOX_NAME)
    recipient.Resolve()
    if not recipient.Resolved:
        raise Exception(f"[ERROR] Shared mailbox '{SHARED_MAILBOX_NAME}' not found.")

    shared_mailbox = namespace.GetSharedDefaultFolder(recipient, 6)  # 6 = Inbox

    # STEP 2: Look for the folder under Inbox
    target_folder = None
    for folder in shared_mailbox.Folders:
        if folder.Name == TARGET_FOLDER_NAME:
            target_folder = folder
            break

    if not target_folder:
        raise Exception(f"[ERROR] Folder '{TARGET_FOLDER_NAME}' not found in shared mailbox.")

    print(f"[INFO] Target folder found: {target_folder.Name}")

except Exception as e:
    print(f"[ERROR] Outlook setup failed: {e}")