import win32com.client

def get_email_from_alias(emp_id):
    """
    Return a list of SMTP addresses for all GAL entries whose Alias matches emp_id.
    """
    outlook   = win32com.client.Dispatch("Outlook.Application")
    namespace = outlook.GetNamespace("MAPI")

    # 1) Grab the Global Address List
    try:
        gal = next(al for al in namespace.AddressLists 
                   if "global address" in al.Name.lower())
    except StopIteration:
        raise RuntimeError("Global Address List not found")

    entries = gal.AddressEntries

    # 2) Filter server-side by Alias
    try:
        # Restrict uses a DASL-style filter
        filt    = f"[Alias] = '{emp_id}'"
        matches = entries.Restrict(filt)
    except Exception as e:
        print(f"Filter failed: {e}")
        return []

    # 3) Extract SMTP addresses
    emails = []
    for entry in matches:
        try:
            user = entry.GetExchangeUser()
            if user:
                emails.append(user.PrimarySmtpAddress)
        except:
            continue

    return emails

if __name__ == "__main__":
    emp_id = input("Enter Employee ID (Alias): ").strip()
    result = get_email_from_alias(emp_id)
    if result:
        print("Found email(s):")
        for addr in result:
            print("  ", addr)
    else:
        print(f"No SMTP address found for Alias={emp_id}")