import win32com.client as win32

# CONFIGURATION
SHARED_MAILBOX_NAME = "testing.coe@noexternalmail.hsbc.com"
TARGET_FOLDER_NAME = "New Python draft shared"

try:
    outlook = win32.Dispatch("Outlook.Application")
    namespace = outlook.GetNamespace("MAPI")

    # STEP 1: Access the shared mailbox
    recipient = namespace.CreateRecipient(SHARED_MAILBOX_NAME)
    if not recipient.Resolved:
        raise Exception(f"[ERROR] Shared mailbox '{SHARED_MAILBOX_NAME}' not found.")

    shared_mailbox = namespace.GetSharedDefaultFolder(recipient, 6)  # 6 = Inbox

    # STEP 2: Check or create the target folder under Inbox
    target_folder = None
    for folder in shared_mailbox.Folders:
        if folder.Name == TARGET_FOLDER_NAME:
            target_folder = folder
            print(f"[INFO] Folder already exists: {target_folder.Name}")
            break

    if not target_folder:
        target_folder = shared_mailbox.Folders.Add(TARGET_FOLDER_NAME)
        print(f"[INFO] Folder '{TARGET_FOLDER_NAME}' created in shared mailbox.")

    print(f"[INFO] Target folder ready: {target_folder.Name}")

except Exception as e:
    print(f"[ERROR] Outlook setup failed: {e}")