import re
import pandas as pd

def parse_outlook_list_to_excel(text_path, output_excel="outlook_parsed_output.xlsx"):
    with open(text_path, 'r', encoding='utf-8') as f:
        content = f.read()

    entries = [entry.strip() for entry in content.split(';') if entry.strip()]

    resolved = []
    missing_ids = []

    for entry in entries:
        # Format: Name <email>
        match = re.match(r'^(.*)<(.*)>$', entry)
        if match:
            name = match.group(1).strip()
            email = match.group(2).strip()
            resolved.append({"Name": name, "Email": email})
        else:
            # Check if it's a plain number (likely an employee ID)
            if re.fullmatch(r'\d+', entry):
                missing_ids.append({"UnresolvedEmployeeID": entry})

    # Create DataFrames
    df_resolved = pd.DataFrame(resolved)
    df_missing = pd.DataFrame(missing_ids)

    # Write both sheets to a single Excel file
    with pd.ExcelWriter(output_excel, engine='openpyxl') as writer:
        df_resolved.to_excel(writer, sheet_name='ResolvedNames', index=False)
        df_missing.to_excel(writer, sheet_name='MissingIDs', index=False)

    print(f"[Done] Saved to '{output_excel}'")
    print(f" - Resolved entries: {len(df_resolved)}")
    print(f" - Missing IDs: {len(df_missing)}")

# Example usage
parse_outlook_list_to_excel("input_outlook_list.txt")